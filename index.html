<!DOCTYPE html>
<html>
	<head>
		<title>DuLeone Craps</title>
		<link href="layout.css" media="all" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<!-- canvas id="board" height='1024' width='768'></canvas -->
		<canvas id="board" style="height: 80%; width: 80%;"></canvas>
		<div id='buffer'></div>
		
		<div id='tableInfo'></div>
		<div id='pointWindow'></div>
		<div id='betForm' class='rounded'>
			<fieldset id='betInfo' class='rounded'>
				<legend>Create a Bet!</legend>
				<p>
					<label for='betType'>Bet Type</label>
					<select id='betType' name='betType'></select><br />
					<p id='betDesc'></p>
					<label for='betValue'>Bet Value</label>
					<input id='betValue' name='betValue' type='text'><br />
					<label for='repeat'>Repeat Bet on Win?</label>
					<input id='betRepeat' name='betRepeat' type='checkbox'>
				</p>
				<p id='origBet'></p>
				<p>
					<button id='create' onclick='create()'>Create Bet!</button>
					<button id='cancel' onclick='cancel()'>Cancel</button>
				</p>
			</fieldset>
		</div>
		<div id='betListing'></div>
		<div id='playerArea'>
			<fieldset id='playerInfo'>
				<legend>Player Info!</legend>
				<div id='name'></div>
				<div id='bank'></div>
				<button id='roll' onclick='roll()'>Roll</button>
				<!--button id='place' onclick='place()'>Place a Bet</button-->
				<button id='reset' onclick='reset()'>Reset Bets</button>
			</fieldset>
		</div>
		
	</body>
	<footer>

		<script src="jquery.min.js" lang='javascript' type='text/javascript'></script>
		<script src="jquery.color.js" lang='javascript' type='text/javascript'></script>
		<script type='text/javascript' language='javascript' src='utils.js'></script>
		<script type='text/javascript' language='javascript' src='dice.js'></script>
		<script type='text/javascript' language='javascript' src='crapsDice.js'></script>
		<script type='text/javascript' language='javascript' src='bets.js'></script>
		<script type='text/javascript' language='javascript' src='crapsBets.js'></script>
		<script type='text/javascript' language='javascript' src='players.js'></script>
		<script type='text/javascript' language='javascript' src='crapsPlayers.js'></script>
		<script type='text/javascript' language='javascript' src='craps.js'></script>
		<script type='text/javascript' language='javascript' src='board.js'></script>

		<script type='text/javascript' language='javascript'>
			
			function draw(Board) {
					var canvas = document.getElementById("board"),
							colors = {
									board: "#090",
									border: "#000",
									lines: "#fff",
									text: "#fff",
									specialText: "#ff0",
									finalText: "#f00"
							};
			
					var board = new Board(canvas, colors);
					board.draw();
			
					canvas.onclick = function(e) {
							//console.log(board.processClick(e.x - canvas.offsetLeft, e.y - canvas.offsetTop));
							boardArea = board.processClick(e.x - canvas.offsetLeft, e.y - canvas.offsetTop);
							if(boardArea){
								clickAreaPlaceBet(boardArea);
							}
					};
			
			}
			draw(Board);
						
			function updateBetDesc(){
				switch($('#betType').val()){
				case "passline":
					$('#betDesc').html('Payout:<br /> 1 pays 1');
					break;
				case "passlineOdds":
					$('#betDesc').html('Payout:<br />Point 4, 10: 1 pays 2<br />Point 5, 9: 2 pays 3 <br />Point 6, 8: 5 pays 6');
					break;
				case "dontPass":
					$('#betDesc').html('Payout:<br /> 1 pays 1');
					break;
				case "dontPassOdds":
					$('#betDesc').html('Payout:<br />Point 4, 10: 2 pays 1<br />Point 5, 9: 3 pays 2 <br />Point 6, 8: 6 pays 5');
					break;
				case "come":
					$('#betDesc').html('Payout:<br /> 1 pays 1');
					break;
				case "comeOdds":
					$('#betDesc').html('Payout:<br />Point 4, 10: 1 pays 2<br />Point 5, 9: 2 pays 3 <br />Point 6, 8: 5 pays 6');
					break;
				case "dontCome":
					$('#betDesc').html('Payout:<br /> 1 pays 1');
					break;
				case "dontComeOdds":
					$('#betDesc').html('Payout:<br />Point 4, 10: 2 pays 1<br />Point 5, 9: 3 pays 2 <br />Point 6, 8: 6 pays 5');
					break;
				case "place4":
					$('#betDesc').html('Payout:<br /> 5 pays 9');
					break;
				case "place5":
					$('#betDesc').html('Payout:<br /> 5 pays 7');
					break;
				case "place6":
					$('#betDesc').html('Payout:<br /> 6 pays 7');
					break;
				case "place8":
					$('#betDesc').html('Payout:<br /> 6 pays 7');
					break;
				case "place9":
					$('#betDesc').html('Payout:<br /> 5 pays 7');
					break;
				case "place10":
					$('#betDesc').html('Payout:<br /> 5 pays 9');
					break;
				case "big6":
					$('#betDesc').html('Payout:<br /> 1 pays 1');
					break;
				case "big8":
					$('#betDesc').html('Payout:<br /> 1 pays 1');
					break;
				case "field":
					$('#betDesc').html('Payout:<br />Roll 3, 4, 9, 10, 11: 1 pays 1<br />Roll 2, 12: 1 pays 2');
					break;
				case "cAndE":
					$('#betDesc').html('Payout:<br />Craps: 1 pays 3<br />Yo-leven: 1 pays 7<br />No Minimum Bet');
					break;
				case "any7":
					$('#betDesc').html('Payout:<br />1 pays 4<br />No Minimum Bet<br />Increments of 3');
					break;
				case "hard4":
					$('#betDesc').html('Payout:<br /> 1 pays 7');
					break;
				case "hard6":
					$('#betDesc').html('Payout:<br /> 1 pays 9');
					break;
				case "hard8":
					$('#betDesc').html('Payout:<br /> 1 pays 9');
					break;
				case "hard10":
					$('#betDesc').html('Payout:<br /> 1 pays 7');
					break;
				case "aceTwo":
					$('#betDesc').html('Payout:<br /> 1 pays 15');
					break;
				case "snakeEyes":
					$('#betDesc').html('Payout:<br /> 1 pays 30');
					break;
				case "midnight":
					$('#betDesc').html('Payout:<br /> 1 pays 30');
					break;
				case "yoleven":
					$('#betDesc').html('Payout:<br /> 1 pays 15');
					break;
				case "anyCraps":
					$('#betDesc').html('Payout: 1 pays 7<br />No Minimum Bet<br />Increments of 4');
					break;
				case "horn":
					$('#betDesc').html('Payout:<br />Roll 2, 12: 4 pays 27<br />Roll 3, 11: 1 pays 3<br />No Minimum Bet<br />Increments of 4');
					break;
				case "world":
					$('#betDesc').html('Payout:<br />Roll 2, 12: 5 pays 26<br />Roll 3, 11: 5 pays 11<br />Roll 7: Push<br />No Minimum Bet<br />Increments of 5');
					break;
				default:
					return false;
				}
			};
			
			function clickAreaPlaceBet(area){
				switch(area.name){
				case "Pass Line":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'passline');
					opt.html(area.name);
					var opt2 = $(document.createElement('option'));
					opt2.attr('value', 'passlineOdds');
					opt2.html('Pass Line Odds');
					$('#betType').append(opt).append(opt2).attr('disabled', false);
					updateBetDesc();
					break;
				case "Don't Pass":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'dontPass');
					opt.html('Don\'t Pass Line');
					var opt2 = $(document.createElement('option'));
					opt2.attr('value', 'dontPassOdds');
					opt2.html('Don\'t Pass Odds');
					$('#betType').append(opt).append(opt2).attr('disabled', false);
					updateBetDesc();
					break;
				case "Come":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'come');
					opt.html('Come Line');
					var opt2 = $(document.createElement('option'));
					opt2.attr('value', 'comeOdds');
					opt2.html('Come Line Odds');
					$('#betType').append(opt).append(opt2).attr('disabled', false);
					updateBetDesc();
					break;
				case "Don't Come":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'dontCome');
					opt.html('Don\'t Come Line');
					var opt2 = $(document.createElement('option'));
					opt2.attr('value', 'dontComeOdds');
					opt2.html('Don\'t Come Odds');
					$('#betType').append(opt).append(opt2).attr('disabled', false);
					updateBetDesc();
					break;
				case "Place 4":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'place4');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Place 5":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'place5');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Place 6":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'place6');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Place 8":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'place8');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Place 9":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'place9');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Place 10":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'place10');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Big 6":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'big6');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Big 8":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'big8');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Field":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'field');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "C and E":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'cAndE');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Seven":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'any7');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Hard 4":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'hard4');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Hard 6":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'hard6');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Hard 8":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'hard8');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Hard 10":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'hard10');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Ace Two":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'aceTwo');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Snake Eyes":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'snakeEyes');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Midnight":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'midnight');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Yo-leven":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'yoleven');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Craps":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'anyCraps');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "Horn":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'horn');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				case "World":
					$('#betType').empty();
					var opt = $(document.createElement('option'));
					opt.attr('value', 'world');
					opt.html(area.name);
					$('#betType').append(opt);
					$('#betType').attr('disabled', 'true');
					updateBetDesc();
					break;
				default:
					return false;
				}
				
				place();
			}
			
			makeCrapsPlayer("Matt", 10000);
			//_CRAPS.players = [p];

			var p = PlayerManager.players[0];
			PlayerManager.updatePlayerArea();
			
			var BET_FADE_INTERVAL = 2000;
			//_CRAPS.placeBet(p.createBet('hard4', 1000));
			//_CRAPS.placeBet(p.createBet('hard6', 1500));
			//_CRAPS.placeBet(p.createBet('passline', 1000));

			function roll(){
				_CRAPS.output("---Rolling---");
				_CRAPS.roll();
				draw(Board);
				//$('#pointWindow').html('Point: ' + ((GameState.point>0)?GameState.point:'None'));
				if($('.winningBet').is(':animated') || $('.losingBet').is(':animated')){
					var animateTimeout = setInterval(
						function(){
							_CRAPS.dealer.betManager.displayBets();
							clearInterval(animateTimeout);
						}, BET_FADE_INTERVAL);
				}else{
					_CRAPS.dealer.betManager.displayBets();
				}
			}
			
			function reset(){
				var _bets = _CRAPS.dealer.betManager.bets
				for(x in _bets){
					if(_bets[x].type == 'passline'){
						if(GameState.point > 0){
							continue;
						}else{
							_CRAPS.dealer.betManager.removeBet(_bets[x].bet.betId);
						}
					}
					if(_bets[x].type == 'come'){
						if(_bets[x].point > 0){
							continue;
						}else{
							_CRAPS.dealer.betManager.removeBet(_bets[x].bet.betId);
						}
					}
					_CRAPS.dealer.betManager.removeBet(_bets[x].bet.betId);
				}
			}
			
			function place(){
				$('#betInfo').width($('#board').width() * (1/4));
				$('#betForm').show()
				$('#betForm').height($('#betInfo').height() + 8 + 4);
				$('#betForm').width($('#betInfo').width() + 8 + 4);
				$('#betForm').animate({left: ($('#playerArea').width() + $('#board').width() - $('#betForm').width()), opacity: 1}, 1000);
			}
			
			$('#betValue').attr('value', _CRAPS.minBet);
			$('#betValue').css({width: '50px'});
			//$('#pointWindow').html('Point: ' + ((GameState.point>0)?GameState.point:'None'));
			//$('#tableInfo').append($(document.createElement('p')).html('3x-4x-5x Odds <br /> Table Min Bet: $' + _CRAPS.minBet + '<br /> Table Max Bet: $' + _CRAPS.maxBet));
			$('#betListing').css({top: ($('#board').height() + 4)});
			$('#betListing').css({left: ($('#buffer').width() + 4), float: 'left'});
			$('#betForm').css({left: ($('#playerArea').width() + $('#board').width())});
			$('#buffer').height($('#board').height() - $('#playerArea').height());
			$('#betType').change(function(){
				$('#origBet').empty();
				if(['passlineOdds', 'comeOdds', 'dontPassOdds', 'dontComeOdds'].indexOf($('#betType').val()) != -1){
					var origBet = $('#origBet');
					var origLabel = $(document.createElement('label'));
					var orig = $(document.createElement('input'));
					orig.attr('type', 'text');
					orig.css({width: '50px'});
					orig.attr('id', 'orig');
					origLabel.html('Original Bet ID: ');
					origBet.append(origLabel).append(orig);
				}
				updateBetDesc();
				var _height = $('#betInfo').height() + 8 + 3;
				$('#betForm').css({height: _height});
			});
			
			function create(){
				//console.log($('#betType').val());
				//console.log($('#betValue').val());
				//console.log($('#betRepeat').is(':checked'));
				//console.log(parseInt($('#betValue').val()));
				var origBet = null;
				if(['passlineOdds', 'comeOdds', 'dontPassOdds', 'dontComeOdds'].indexOf($('#betType').val()) != -1){
					origBet = _CRAPS.dealer.betManager.getBetById($('#orig').val());
				}
				var newBet = p.createBet($('#betType').val(), parseInt($('#betValue').val()), $('#betRepeat').is(':checked'), origBet);
				//console.log('Placing bet:', newBet.toString());
				_CRAPS.placeBet(newBet);
				PlayerManager.updatePlayerArea();
				$('#betForm').animate({left: ($('#playerArea').width() + $('#board').width()), opacity: 0}, 1000, function(){$('#betForm').hide();});
			}
			function cancel(){
				$('#betForm').animate({left: ($('#playerArea').width() + $('#board').width()), opacity: 0}, 1000, function(){$('#betForm').hide();});
			}
		</script>
		</footer>
</html>
